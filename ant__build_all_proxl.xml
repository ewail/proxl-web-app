<?xml version="1.0" encoding="US-ASCII" ?>
<project name="Proxl_Root_Build_All_Proxl" default="createInstallables" basedir=".">

	<!--

	  Ant build to build everything for Proxl.

	  Run the default target to build everything.

	  If ant is installed and on the PATH,
	  enter on the command line   "ant -f  ant__build_all_proxl.xml"
	  in the base directory to build everything.

	  -->


	<property name="config_file" value="aa_ant__build_all_proxl_config.properties" />
	
	<property name="config_file_with_path" 
		value="${config_file}"/>

	<echo>Using Config file ${config_file_with_path}</echo>
	
	<fail message="ERROR: '${config_file}' file not found, check the path. filename with path: ${config_file_with_path}">
		<condition>
		    <not>
		    	<available file="${config_file_with_path}" />
		    </not>
		</condition>
	</fail>
	
	<echo>config_file_with_path: ${config_file_with_path}</echo>
	
	<!-- This does not fail if the file is not found -->
	<property file="${config_file_with_path}" />
	
	<echo>gradle.wrapper.executable: ${gradle.wrapper.executable}</echo>
	

	<!--  -->
	<target name="clean" >
		<delete dir="deploy" />
	</target>

	<!-- Prepare depends on clean -->
	<target name="prepare" depends="clean">
		<mkdir dir="deploy" />
	</target>

	<!--
		compileAllSubmodules depends on prepare
		executes external builds for each sub project
	 -->
	<target name="compileAllSubmodules" depends="prepare">

		<!--  Build submodules and create runnable jars -->

		<!--  web app  -->		
		<exec executable="${gradle.wrapper.executable}" dir="proxl_web_app" failonerror="true" >
			<arg value="build" />
			<!--   <arg value="XXXX" /> -->
		</exec>

		<!--  importer  -->		
		<exec executable="${gradle.wrapper.executable}" dir="proxl_importer" failonerror="true" >
			<arg value="build" />
			<!--   <arg value="XXXX" /> -->
		</exec>
		<!--  importer executable jar -->		
		<ant dir="proxl_importer/build_runnable_jar" antfile="ant__create_runnable_jar_importer.xml" />

		<!-- run importer  -->		
		<exec executable="${gradle.wrapper.executable}" dir="proxl_run_importer" failonerror="true" >
			<arg value="build" />
			<!--   <arg value="XXXX" /> -->
		</exec>
		<!-- run importer executable jar -->		
		<ant dir="proxl_run_importer/build_runnable_jar" antfile="ant__create_runnable_jar_run_importer.xml" />
		
		<!-- submit import  -->		
		<exec executable="${gradle.wrapper.executable}" dir="proxl_submit_import" failonerror="true" >
			<arg value="build" />
			<!--   <arg value="XXXX" /> -->
		</exec>
		<!-- submit import executable jar -->		
		<ant dir="proxl_submit_import/build_runnable_jar" antfile="ant__create_runnable_jar_submit_import.xml" />
		
		
	</target>
	

	<!--
		createInstallables depends on compileAllSubmodules
	-->
	<target name="createInstallables" depends="compileAllSubmodules">

		<!-- copy files from subdir 'deploy' to deploy -->
		<copy file="proxl_web_app/build/libs/proxl.war" todir="deploy" />
		<copy file="proxl_importer/build_runnable_jar/deploy/importProxlXML.jar" todir="deploy" />
		<copy file="proxl_run_importer/build_runnable_jar/deploy/runImportProxlXML.jar" todir="deploy" />
		<copy file="proxl_submit_import/build_runnable_jar/deploy/submitProxlXMLImport.jar" todir="deploy" />
		
	</target>
	
</project>
